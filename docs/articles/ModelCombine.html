<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2.0 Combine Models â€¢ tswgewrapped</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2.0 Combine Models">
<meta property="og:description" content="tswgewrapped">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tswgewrapped</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.10.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ModelBuildMultivariateVAR.html">1.2.1 Build Multivariate VAR Models</a>
    </li>
    <li>
      <a href="../articles/ModelCombine.html">2.0 Combine Models</a>
    </li>
    <li>
      <a href="../articles/ModelCompareMultivariateVAR.html">1.2.2 Compare Multivariate VAR Models</a>
    </li>
    <li>
      <a href="../articles/ModelCompareNNforCaret.html">1.3.2 Compare nnfor::mlp() models</a>
    </li>
    <li>
      <a href="../articles/ModelCompareUnivariate.html">1.1.2 Compare Univariate Models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2.0 Combine Models</h1>
            
      
      
      <div class="hidden name"><code>ModelCombine.Rmd</code></div>

    </div>

    
    
<div id="setup-libraries" class="section level1">
<h1 class="hasAnchor">
<a href="#setup-libraries" class="anchor"></a>Setup Libraries</h1>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tswgewrapped</span>)</pre></body></html></div>
</div>
<div id="load-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load Data</h1>
<div class="sourceCode"><html><body><pre class="r"># Load Data
file = system.file("extdata", "USeconomic.csv", package = "tswgewrapped", mustWork = TRUE)
USeconomic = read.csv(file, header = TRUE, stringsAsFactors = FALSE, check.names = FALSE)
names(USeconomic) = gsub("[(|)]", "", colnames(USeconomic))
data = USeconomic</pre></body></html></div>
</div>
<div id="model-global-settings" class="section level1">
<h1 class="hasAnchor">
<a href="#model-global-settings" class="anchor"></a>Model Global Settings</h1>
<div class="sourceCode"><html><body><pre class="r">var_interest = 'logGNP'
batch_size = 132
n.ahead = 2</pre></body></html></div>
</div>
<div id="build-and-compare-models" class="section level1">
<h1 class="hasAnchor">
<a href="#build-and-compare-models" class="anchor"></a>1.0 Build and Compare Models</h1>
<div id="univariate" class="section level2">
<h2 class="hasAnchor">
<a href="#univariate" class="anchor"></a>1.1 Univariate</h2>
<div class="sourceCode"><html><body><pre class="r">models = list("Univar A" = list(phi = 0.9, d = 1, s = 0, sliding_ase = TRUE),
              "Univar B" = list(phi = 0.9, d = 1, s = 4, sliding_ase = TRUE),
              "Univar C" = list(phi = 0.9, d = 1, s = 4, sliding_ase = FALSE)
              )

mdl_compare_uni = ModelCompareUnivariate$new(data = data, var_interest = var_interest, mdl_list = models,
                                             n.ahead = n.ahead, batch_size = batch_size)
#&gt; 
#&gt; Batch Size has not been specified. Will assume a single batch.NULL</pre></body></html></div>
</div>
<div id="var" class="section level2">
<h2 class="hasAnchor">
<a href="#var" class="anchor"></a>1.2 VAR</h2>
<div class="sourceCode"><html><body><pre class="r">lag.max = 10

models = list("AIC None" = list(select = "aic", trend_type = "none", lag.max = lag.max),
              "AIC Trend" = list(select = "aic", trend_type = "trend", lag.max = lag.max),
              "AIC Both" = list(select = "aic", trend_type = "both", lag.max = lag.max))


mdl_build_var = ModelBuildMultivariateVAR$new(data = data, var_interest = var_interest,
                                              mdl_list = models, verbose = 0)
#&gt; Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [4].

mdl_build_var$build_recommended_models()
#&gt; Warning in mdl_build_var$build_recommended_models(): This recommendation
#&gt; is to use just the variable of interest (dependent variable) to model the
#&gt; time series, hence this model will not be built. Please use a univariate
#&gt; approach to model this separately.
models = mdl_build_var$get_final_models(subset = 'r')

# Setup Models to be compared with sliding ASE = TRUE
for (name in names(models)){
  models[[name]][['sliding_ase']] = TRUE
}

# Initialize the ModelCompareMultivariateVAR object
mdl_compare_var = ModelCompareMultivariateVAR$new(data = data, var_interest = var_interest,
                                                  mdl_list = models, n.ahead = n.ahead, batch_size = batch_size, verbose = 0)
#&gt; # A tibble: 2 x 6
#&gt;   Model         Trend Season SlidingASE Init_K Final_K
#&gt;   <chr><chr><dbl><lgl><dbl><dbl>
#&gt; 1 AIC Both - R  both       0 TRUE            3       3
#&gt; 2 AIC Trend - R trend      0 TRUE            1       1</dbl></dbl></lgl></dbl></chr></chr></pre></body></html></div>
</div>
<div id="nnformlp-caret" class="section level2">
<h2 class="hasAnchor">
<a href="#nnformlp-caret" class="anchor"></a>1.3 NNFOR::mlp() Caret</h2>
<p><strong>Since this process takes some time, I have commented this out for now and saved an already created caret model. However, feel free to uncomment this and run the model build process.</strong></p>
<div class="sourceCode"><html><body><pre class="r"># library(caret)
# 
# # Random Parallel
# model = ModelBuildNNforCaret$new(data = data, var_interest = "logGNP", m = 2,
#                                  search = 'random',
#                                  grid = NA, tuneLength = 2,
#                                  batch_size = 132, h = 2,
#                                  parallel = TRUE,
#                                  seed = 1,
#                                  verbose = 1)
# 
# model$summarize_hyperparam_results()
# caret_model = model$get_final_models(subset = 'a')

file = system.file("extdata", "caret_model_batch_ase.rds", package = "tswgewrapped", mustWork = TRUE)
caret_model = readRDS(file)

# Initialize the ModelCompareMultivariateVAR object
mdl_compare_mlp = ModelCompareNNforCaret$new(data = data, var_interest = var_interest,
                                             mdl_list = caret_model,
                                             verbose = 1)
#&gt; 
#&gt; Computing metrics for:  reps15_hd5_sdetFALSE
#&gt; Warning in private$models[[name]]$ASEs = res$ASEs: Coercing LHS to a list
#&gt; 
#&gt; Computing metrics for:  reps19_hd2_sdetFALSE
#&gt; Warning in private$models[[name]]$ASEs = res$ASEs: Coercing LHS to a list
#&gt; NULL</pre></body></html></div>
</div>
</div>
<div id="combine-all-models" class="section level1">
<h1 class="hasAnchor">
<a href="#combine-all-models" class="anchor"></a>2.0 Combine all models</h1>
<div class="sourceCode"><html><body><pre class="r">mdl_combine = ModelCombine$new(data = data, var_interest = "logGNP",
                               uni_models = mdl_compare_uni, var_models = mdl_compare_var, mlp_models = mdl_compare_mlp,
                               verbose = 1)</pre></body></html></div>
<div id="statistical-comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#statistical-comparison" class="anchor"></a>Statistical Comparison</h2>
<div class="sourceCode"><html><body><pre class="r"><span class="no">mdl_combine</span>$<span class="fu">plot_boxplot_ases</span>()</pre></body></html></div>
<p><img src="ModelCombine_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode"><html><body><pre class="r">comparison = mdl_combine$statistical_compare()
#&gt; Loading required namespace: patchwork
#&gt;             Df    Sum Sq   Mean Sq F value Pr(&gt;F)
#&gt; Model        4 3.082e-07 7.705e-08   0.865  0.517
#&gt; Residuals   10 8.903e-07 8.903e-08               
#&gt; 
#&gt; 
#&gt;   Tukey multiple comparisons of means
#&gt;     95% family-wise confidence level
#&gt; 
#&gt; Fit: aov(formula = ASE ~ Model, data = results)
#&gt; 
#&gt; $Model
#&gt;                                             diff           lwr
#&gt; AIC Trend - R-AIC Both - R         -3.050861e-04 -0.0011068903
#&gt; reps19_hd2_sdetFALSE-AIC Both - R  -3.280151e-04 -0.0011298193
#&gt; Univar A-AIC Both - R              -3.671261e-04 -0.0011689303
#&gt; Univar B-AIC Both - R              -3.974854e-04 -0.0011992896
#&gt; reps19_hd2_sdetFALSE-AIC Trend - R -2.292902e-05 -0.0008247332
#&gt; Univar A-AIC Trend - R             -6.203999e-05 -0.0008638442
#&gt; Univar B-AIC Trend - R             -9.239935e-05 -0.0008942036
#&gt; Univar A-reps19_hd2_sdetFALSE      -3.911096e-05 -0.0008409152
#&gt; Univar B-reps19_hd2_sdetFALSE      -6.947033e-05 -0.0008712746
#&gt; Univar B-Univar A                  -3.035936e-05 -0.0008321636
#&gt;                                             upr     p adj
#&gt; AIC Trend - R-AIC Both - R         0.0004967182 0.7235876
#&gt; reps19_hd2_sdetFALSE-AIC Both - R  0.0004737891 0.6713829
#&gt; Univar A-AIC Both - R              0.0004346782 0.5806934
#&gt; Univar B-AIC Both - R              0.0004043188 0.5116637
#&gt; reps19_hd2_sdetFALSE-AIC Trend - R 0.0007788752 0.9999788
#&gt; Univar A-AIC Trend - R             0.0007397642 0.9989039
#&gt; Univar B-AIC Trend - R             0.0007094049 0.9948724
#&gt; Univar A-reps19_hd2_sdetFALSE      0.0007626933 0.9998224
#&gt; Univar B-reps19_hd2_sdetFALSE      0.0007323339 0.9982948
#&gt; Univar B-Univar A                  0.0007714449 0.9999351</pre></body></html></div>
</div>
<div id="ases" class="section level2">
<h2 class="hasAnchor">
<a href="#ases" class="anchor"></a>ASEs</h2>
<div class="sourceCode"><html><body><pre class="r">ases = mdl_combine$get_tabular_metrics()
ases
#&gt; # A tibble: 16 x 5
#&gt;    Model                       ASE Time_Test_Start Time_Test_End Batch
#&gt;    <chr><dbl><dbl><dbl><dbl>
#&gt;  1 Univar A             0.0000575              131           132     1
#&gt;  2 Univar A             0.000180               133           134     2
#&gt;  3 Univar A             0.0000124              135           136     3
#&gt;  4 Univar B             0.00000362             131           132     1
#&gt;  5 Univar B             0.000134               133           134     2
#&gt;  6 Univar B             0.0000212              135           136     3
#&gt;  7 Univar C             0.0000212              135           136     1
#&gt;  8 AIC Both - R         0.00117                131           132     1
#&gt;  9 AIC Both - R         0.000167               133           134     2
#&gt; 10 AIC Both - R         0.0000180              135           136     3
#&gt; 11 AIC Trend - R        0.000379               131           132     1
#&gt; 12 AIC Trend - R        0.0000354              133           134     2
#&gt; 13 AIC Trend - R        0.0000212              135           136     3
#&gt; 14 reps19_hd2_sdetFALSE 0.000124               131           132     1
#&gt; 15 reps19_hd2_sdetFALSE 0.000163               133           134     2
#&gt; 16 reps19_hd2_sdetFALSE 0.0000810              135           136     3</dbl></dbl></dbl></dbl></chr></pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r">mdl_combine$plot_batch_ases()
#&gt; Warning: Removed 650 row(s) containing missing values (geom_path).</pre></body></html></div>
<p><img src="ModelCombine_files/figure-html/unnamed-chunk-11-1.png" width="1152"></p>
</div>
<div id="forecasts" class="section level2">
<h2 class="hasAnchor">
<a href="#forecasts" class="anchor"></a>Forecasts</h2>
<div class="sourceCode"><html><body><pre class="r">forecasts = mdl_combine$get_tabular_metrics(ases = FALSE)
forecasts
#&gt; # A tibble: 958 x 5
#&gt;    Model     Time     f    ll    ul
#&gt;    <chr><dbl><dbl><dbl><dbl>
#&gt;  1 Univar A     1    NA    NA    NA
#&gt;  2 Univar A     2    NA    NA    NA
#&gt;  3 Univar A     3    NA    NA    NA
#&gt;  4 Univar A     4    NA    NA    NA
#&gt;  5 Univar A     5    NA    NA    NA
#&gt;  6 Univar A     6    NA    NA    NA
#&gt;  7 Univar A     7    NA    NA    NA
#&gt;  8 Univar A     8    NA    NA    NA
#&gt;  9 Univar A     9    NA    NA    NA
#&gt; 10 Univar A    10    NA    NA    NA
#&gt; # ... with 948 more rows</dbl></dbl></dbl></dbl></chr></pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r">mdl_combine$plot_batch_forecasts()
#&gt; Warning: Removed 520 row(s) containing missing values (geom_path).</pre></body></html></div>
<p><img src="ModelCombine_files/figure-html/unnamed-chunk-13-1.png" width="1152"></p>
<pre><code>#&gt; Warning: Removed 520 row(s) containing missing values (geom_path).

#&gt; Warning: Removed 520 row(s) containing missing values (geom_path).</code></pre>
<p><img src="ModelCombine_files/figure-html/unnamed-chunk-13-2.png" width="1152"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Josephs, Nikhil Gupta.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
